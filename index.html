<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=800, initial-scale=1.0">
  <title>Double-Edge - Main</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="game-container">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <audio id="backgroundMusic" loop preload="auto" controls style="display:none;">
      <source src="assets/sound effects/background.mp4" type="video/mp4">
      <!-- Add MP3 fallback if you convert the file -->
      <!-- <source src="assets/sound effects/background.mp3" type="audio/mpeg"> -->
      Your browser does not support the audio element.
    </audio>
    <button id="skip-cutscene-btn" style="position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:3000;display:none;padding:10px 20px;font-family:'Press Start 2P','Courier New',monospace;font-size:16px;background:#222;color:#fff;border:3px solid #f0f;border-radius:8px;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,0.5), 0 0 10px rgba(255,0,255,0.3);transition:all 0.2s;image-rendering:pixelated;-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale;font-smooth:never;text-rendering:geometricPrecision;">Skip Cutscene</button>
    <div id="ui">
  <div id="hearts" style="display:flex;justify-content:center;align-items:center;margin:0 auto;"></div>
  <div id="ammo-bar" style="display:flex;justify-content:center;align-items:center;margin:10px auto;"></div>
  <div id="powerup"></div>
      <div id="prompt">Press E to sacrifice a heart for a power-up</div>
    </div>
  </div>
  <button id="fullscreen-btn" style="position:fixed;bottom:24px;right:24px;z-index:2001;">Fullscreen</button>
    <div id="cooldown-bottom"></div>
    <div id="weapon-selector" style="position:fixed;top:0;right:0;width:200px;height:auto;background:#181818e0;color:#fff;z-index:1000;padding:16px;box-shadow:-2px 0 8px #000;">
  <button id="reset-btn" style="width:100%;margin-bottom:16px;padding:10px 0;font-size:24px;font-family:'Press Start 2P','Courier New',monospace;background:linear-gradient(90deg,#222,#444);color:#fff;border:none;border-radius:8px;box-shadow:0 2px 16px #000, 0 0 8px #fff inset;letter-spacing:2px;cursor:pointer;transition:transform 0.1s;outline:none;image-rendering:pixelated;-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale;">
        &#x21bb; RESET GAME
      </button>
      <h3 style="margin-top:0;font-family:'Press Start 2P','Courier New',monospace;font-size:24px;image-rendering:pixelated;-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale;font-smooth:never;text-rendering:geometricPrecision;font-synthesis:none;font-kerning:none;">Weapon Select</h3>
      <div id="weapon-container"></div>
    </div>
  <script type="module" src="game.js"></script>
  <script type="module">
    // Background music management
    const backgroundMusic = document.getElementById('backgroundMusic');
    let musicStarted = false;
    
    // Add debugging event listeners
    backgroundMusic.addEventListener('loadstart', () => console.log('Audio: loadstart'));
    backgroundMusic.addEventListener('loadeddata', () => console.log('Audio: loadeddata'));
    backgroundMusic.addEventListener('canplay', () => console.log('Audio: canplay'));
    backgroundMusic.addEventListener('canplaythrough', () => console.log('Audio: canplaythrough'));
    backgroundMusic.addEventListener('error', (e) => console.error('Audio error:', e));
    backgroundMusic.addEventListener('play', () => console.log('Audio: play event'));
    backgroundMusic.addEventListener('pause', () => console.log('Audio: pause event'));
    
    // Function to start background music
    function startBackgroundMusic() {
      if (!musicStarted) {
        console.log('Attempting to start background music...');
        backgroundMusic.volume = 0.3; // Set volume to 30%
        backgroundMusic.play().then(() => {
          console.log('Background music started successfully');
          musicStarted = true;
        }).catch(e => {
          console.error('Background music autoplay prevented:', e);
          console.log('Music will start on first user interaction');
          // Music will start on first user interaction
        });
      }
    }
    
    // Function to pause background music
    function pauseBackgroundMusic() {
      if (!backgroundMusic.paused) {
        backgroundMusic.pause();
      }
    }
    
    // Function to resume background music
    function resumeBackgroundMusic() {
      if (backgroundMusic.paused && musicStarted) {
        backgroundMusic.play().catch(e => {
          console.log('Failed to resume background music:', e);
        });
      }
    }
    
    // Start music on first user interaction (to comply with browser autoplay policies)
    function initMusicOnInteraction() {
      startBackgroundMusic();
      document.removeEventListener('click', initMusicOnInteraction);
      document.removeEventListener('keydown', initMusicOnInteraction);
    }
    
    document.addEventListener('click', initMusicOnInteraction);
    document.addEventListener('keydown', initMusicOnInteraction);
    
    // Make music control functions globally accessible for game.js
    window.pauseBackgroundMusic = pauseBackgroundMusic;
    window.resumeBackgroundMusic = resumeBackgroundMusic;
    window.startBackgroundMusic = startBackgroundMusic;
    
    // Sword swing sound function - randomly selects from sword swings folder
    window.playSwordSwingSound = function() {
      // Complete list of ALL sword swing sound files
      const swordSwingSounds = [
        'assets/sound effects/sword swings/sword swing.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cable_whoosh_air_001_26718.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cable_whoosh_air_002_26719.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cable_whoosh_air_003_26720.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_bambo_stick_swing_whoosh_air_001_17291.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_bambo_stick_swing_whoosh_air_002_17292.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whip_swish_through_air_001_20195.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whip_swish_through_air_002_20196.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whip_swish_through_air_003_20197.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whoosh_through_air_whip_001_11671.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whoosh_through_air_whip_002_11672.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whoosh_through_air_whip_003_11673.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whoosh_through_air_whip_004_11674.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_stick_bambo_swing_swipe_whoosh_air_001_65220.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_stick_bambo_swing_swipe_whoosh_air_002_65221.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_stick_bambo_swing_swipe_whoosh_air_003_65222.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_stick_bambo_swing_swipe_whoosh_air_004_65223.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_001_89430.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_002_89431.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_003_89432.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_004_89433.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_005_89434.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_crowbar_swing_in_air_whoosh_001_30568.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_crowbar_swing_in_air_whoosh_002_30569.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_crowbar_swing_in_air_whoosh_003_30570.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_crowbar_swing_in_air_whoosh_004_30571.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_pole_swing_in_air_whoosh_001_28122.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_pole_swing_in_air_whoosh_002_28123.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_rope_or_cable_whip_swish_through_air_short_spin_11946.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_bendy_whoosh_air_fast_001_12681.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_bendy_whoosh_air_fast_002_12682.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_bendy_whoosh_air_fast_003_12683.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_medium_sized_swing_whoosh_swoosh_through_air_001_90352.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_medium_sized_swing_whoosh_swoosh_through_air_002_90353.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_medium_sized_swing_whoosh_swoosh_through_air_003_90354.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_swish_swoosh_air_001.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_swish_swoosh_air_002.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_or_thin_object_swipe_swoosh_whip_through_air_69680.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_or_thin_object_swipe_swoosh_whip_through_air_fast_001_69681.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_or_thin_object_swipe_swoosh_whip_through_air_fast_002_69682.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_plastic_swipe_swing_through_air_whip_001_16839.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_plastic_swipe_swing_through_air_whip_002_16840.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_snooker_cue_swing_air_whoosh_001_26787.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_snooker_cue_swing_air_whoosh_002_26788.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_snooker_cue_swing_air_whoosh_003_26789.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_thin_object_very_fast_whoosh_swoosh_whip_through_air_001_90355.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_thin_object_very_fast_whoosh_swoosh_whip_through_air_002_90356.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_thin_object_very_fast_whoosh_swoosh_whip_through_air_003_90357.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_thin_object_very_fast_whoosh_swoosh_whip_through_air_004_90358.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_twig_swish_air_fast.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_whoosh_swish_air_short_001_89264.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_whoosh_swish_air_short_002_89265.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_whoosh_swish_air_short_003_89266.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_whoosh_swish_air_short_004_89267.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_thin_stick_swing_swipe_swoosh_whoosh_through_air_001_90359.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_thin_stick_swing_swipe_swoosh_whoosh_through_air_002_90360.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_thin_stick_swing_swipe_swoosh_whoosh_through_air_003_90361.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_thin_stick_swing_swipe_swoosh_whoosh_through_air_004_90362.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_whoosh_whip_swoosh_fast_001_55829.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_whoosh_whip_swoosh_fast_002_55797.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_whoosh_whip_swoosh_fast_spinning_55802.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_wooden_tube_swing_in_air_swoosh_whoosh_single_001_74987.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_wooden_tube_swing_in_air_swoosh_whoosh_single_002_74988.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_wooden_tube_swing_in_air_swoosh_whoosh_single_003_74989.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_wooden_tube_swing_in_air_swoosh_whoosh_single_004_74990.mp3'
      ];
      
      try {
        // Randomly select a sound file
        const randomIndex = Math.floor(Math.random() * swordSwingSounds.length);
        const selectedSound = swordSwingSounds[randomIndex];
        
        // Create a new audio element for this specific sound
        const swordAudio = new Audio();
        
        // Set up audio properties before setting src
        swordAudio.volume = 0.3; // Set volume to 30%
        swordAudio.playbackRate = 1.0; // Always 100% pitch
        swordAudio.preload = 'auto';
        
        // Set up error handling
        swordAudio.onerror = function(e) {
          console.log('Audio load error for:', selectedSound, e);
        };
        
        // Set up success handling
        swordAudio.oncanplaythrough = function() {
          swordAudio.play().catch(e => {
            console.log('Failed to play sword swing sound:', selectedSound, e);
          });
        };
        
        // Set the source (this triggers loading)
        swordAudio.src = selectedSound;
        swordAudio.load(); // Force reload
        
        console.log('Loading sword swing:', selectedSound);
        
        // Fallback: try to play immediately in case oncanplaythrough doesn't fire
        setTimeout(() => {
          if (swordAudio.readyState >= 2) { // HAVE_CURRENT_DATA or better
            swordAudio.play().catch(e => {
              console.log('Fallback play failed:', e);
            });
          }
        }, 100);
        
      } catch (error) {
        console.error('Error in playSwordSwingSound:', error);
      }
    };
    
    // Scythe swing sound function - uses same sword swing sounds for consistency
    window.playScytheSwingSound = function() {
      // Complete list of ALL sword swing sound files (reused for scythe)
      const scytheSwingSounds = [
        'assets/sound effects/sword swings/sword swing.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cable_whoosh_air_001_26718.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cable_whoosh_air_002_26719.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cable_whoosh_air_003_26720.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_bambo_stick_swing_whoosh_air_001_17291.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_bambo_stick_swing_whoosh_air_002_17292.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whip_swish_through_air_001_20195.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whip_swish_through_air_002_20196.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whip_swish_through_air_003_20197.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whoosh_through_air_whip_001_11671.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whoosh_through_air_whip_002_11672.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whoosh_through_air_whip_003_11673.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_cane_whoosh_through_air_whip_004_11674.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_stick_bambo_swing_swipe_whoosh_air_001_65220.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_stick_bambo_swing_swipe_whoosh_air_002_65221.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_stick_bambo_swing_swipe_whoosh_air_003_65222.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_stick_bambo_swing_swipe_whoosh_air_004_65223.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_001_89430.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_002_89431.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_003_89432.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_004_89433.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_large_wooden_pole_swing_air_whoosh_swoosh_heavy_005_89434.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_crowbar_swing_in_air_whoosh_001_30568.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_crowbar_swing_in_air_whoosh_002_30569.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_crowbar_swing_in_air_whoosh_003_30570.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_crowbar_swing_in_air_whoosh_004_30571.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_pole_swing_in_air_whoosh_001_28122.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_metal_pole_swing_in_air_whoosh_002_28123.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_rope_or_cable_whip_swish_through_air_short_spin_11946.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_bendy_whoosh_air_fast_001_12681.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_bendy_whoosh_air_fast_002_12682.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_bendy_whoosh_air_fast_003_12683.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_medium_sized_swing_whoosh_swoosh_through_air_001_90352.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_medium_sized_swing_whoosh_swoosh_through_air_002_90353.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_medium_sized_swing_whoosh_swoosh_through_air_003_90354.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_swish_swoosh_air_001.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_branch_swish_swoosh_air_002.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_or_thin_object_swipe_swoosh_whip_through_air_69680.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_or_thin_object_swipe_swoosh_whip_through_air_fast_001_69681.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_or_thin_object_swipe_swoosh_whip_through_air_fast_002_69682.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_plastic_swipe_swing_through_air_whip_001_16839.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_plastic_swipe_swing_through_air_whip_002_16840.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_snooker_cue_swing_air_whoosh_001_26787.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_snooker_cue_swing_air_whoosh_002_26788.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_snooker_cue_swing_air_whoosh_003_26789.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_thin_object_very_fast_whoosh_swoosh_whip_through_air_001_90355.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_thin_object_very_fast_whoosh_swoosh_whip_through_air_002_90356.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_thin_object_very_fast_whoosh_swoosh_whip_through_air_003_90357.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_thin_object_very_fast_whoosh_swoosh_whip_through_air_004_90358.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_twig_swish_air_fast.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_whoosh_swish_air_short_001_89264.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_whoosh_swish_air_short_002_89265.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_whoosh_swish_air_short_003_89266.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_stick_whoosh_swish_air_short_004_89267.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_thin_stick_swing_swipe_swoosh_whoosh_through_air_001_90359.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_thin_stick_swing_swipe_swoosh_whoosh_through_air_002_90360.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_thin_stick_swing_swipe_swoosh_whoosh_through_air_003_90361.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_thin_stick_swing_swipe_swoosh_whoosh_through_air_004_90362.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_whoosh_whip_swoosh_fast_001_55829.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_whoosh_whip_swoosh_fast_002_55797.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_whoosh_whip_swoosh_fast_spinning_55802.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_wooden_tube_swing_in_air_swoosh_whoosh_single_001_74987.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_wooden_tube_swing_in_air_swoosh_whoosh_single_002_74988.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_wooden_tube_swing_in_air_swoosh_whoosh_single_003_74989.mp3',
        'assets/sound effects/sword swings/zapsplat_foley_wooden_tube_swing_in_air_swoosh_whoosh_single_004_74990.mp3'
      ];
      
      try {
        // Randomly select a sound file
        const randomIndex = Math.floor(Math.random() * scytheSwingSounds.length);
        const selectedSound = scytheSwingSounds[randomIndex];
        
        // Create a new audio element for this specific sound
        const scytheAudio = new Audio();
        
        // Set up audio properties before setting src
        scytheAudio.volume = 0.35; // Slightly louder than sword for heavier weapon
        scytheAudio.playbackRate = 0.9; // Slightly slower pitch for heavier scythe
        scytheAudio.preload = 'auto';
        
        // Set up error handling
        scytheAudio.onerror = function(e) {
          console.log('Audio load error for scythe:', selectedSound, e);
        };
        
        // Set up success handling
        scytheAudio.oncanplaythrough = function() {
          scytheAudio.play().catch(e => {
            console.log('Failed to play scythe swing sound:', selectedSound, e);
          });
        };
        
        // Set the source (this triggers loading)
        scytheAudio.src = selectedSound;
        scytheAudio.load(); // Force reload
        
        console.log('Loading scythe swing:', selectedSound);
        
        // Fallback: try to play immediately in case oncanplaythrough doesn't fire
        setTimeout(() => {
          if (scytheAudio.readyState >= 2) { // HAVE_CURRENT_DATA or better
            scytheAudio.play().catch(e => {
              console.log('Fallback scythe play failed:', e);
            });
          }
        }, 100);
        
      } catch (error) {
        console.error('Error in playScytheSwingSound:', error);
      }
    };
    
    // Devil cutscene random sound function
    window.playRandomDevilSound = function() {
      // Complete list of ALL devil cutscene sound files
      const devilSounds = [
        'assets/sound effects/devil cutscene/ghostbreath.flac',
        'assets/sound effects/devil cutscene/output (1).wav',
        'assets/sound effects/devil cutscene/output (2).wav',
        'assets/sound effects/devil cutscene/output (3).wav',
        'assets/sound effects/devil cutscene/output (4).wav',
        'assets/sound effects/devil cutscene/output (5).wav',
        'assets/sound effects/devil cutscene/output (6).wav',
        'assets/sound effects/devil cutscene/output (7).wav',
        'assets/sound effects/devil cutscene/output (8).wav',
        'assets/sound effects/devil cutscene/output (9).wav',
        'assets/sound effects/devil cutscene/output (10).wav',
        'assets/sound effects/devil cutscene/output (11).wav',
        'assets/sound effects/devil cutscene/output (12).wav',
        'assets/sound effects/devil cutscene/output (13).wav',
        'assets/sound effects/devil cutscene/output (14).wav',
        'assets/sound effects/devil cutscene/output (15).wav',
        'assets/sound effects/devil cutscene/scaryhighpitchedghost.wav'
      ];
      
      // Randomly select a sound file
      const randomIndex = Math.floor(Math.random() * devilSounds.length);
      const selectedSound = devilSounds[randomIndex];
      
      // Create a new audio element for this specific sound
      const devilAudio = new Audio(selectedSound);
      devilAudio.volume = 0.4; // Set volume to 40% for atmosphere
      devilAudio.playbackRate = 1.0; // Always 100% pitch
      
      console.log('Playing devil cutscene sound:', selectedSound);
      
      devilAudio.play().catch(e => {
        console.log('Failed to play devil cutscene sound:', e);
      });
    };
    
    const weapons = [
      { name: 'Sword', id: 'sword', description: 'Default balanced weapon. [Attack: SPACE]' },
      { name: 'Scythe', id: 'scythe', description: 'More range, more damage, slower cooldown. [Attack: SPACE]' },
      { name: 'Spellcaster', id: 'spellcaster', description: 'Cast spells: [Fireball: Z] [Ice: C] [Heal: R]' },
      { name: 'Bow', id: 'bow', description: 'Ranged precision damage. [Hold SPACE to charge & aim]' }
    ];
    
    let weaponContainer = document.getElementById('weapon-container');
    let lastWeaponSwitch = 0;
    const WEAPON_COOLDOWN = 5000; // 5 seconds in milliseconds
    
    // Make renderWeaponSelector globally accessible
    window.renderWeaponSelector = function renderWeaponSelector() {
      if (!window.game || !window.game.player) {
        weaponContainer.innerHTML = '<p style="font-size:18px;color:#888;font-family:\'Press Start 2P\',\'Courier New\',monospace;image-rendering:pixelated;-webkit-font-smoothing:none;">Game loading...</p>';
        return;
      }
      
      const currentWeapon = window.game.player.weapon;
      const currentTime = Date.now();
      const timeSinceLastSwitch = currentTime - lastWeaponSwitch;
      const cooldownRemaining = Math.max(0, WEAPON_COOLDOWN - timeSinceLastSwitch);
      const isOnCooldown = cooldownRemaining > 0;
      
      // Calculate opacity based on cooldown
      const baseOpacity = isOnCooldown ? 0.4 : 1.0;
      
      weaponContainer.innerHTML = '';
      
      // Add cooldown indicator if on cooldown
      if (isOnCooldown) {
        const cooldownDiv = document.createElement('div');
        cooldownDiv.style.cssText = `
          margin:8px 0;
          padding:8px;
          border-radius:6px;
          background:#400;
          border:2px solid #f00;
          text-align:center;
        `;
        cooldownDiv.innerHTML = `
          <span style="font-family:'Press Start 2P','Courier New',monospace;font-size:14px;color:#fff;image-rendering:pixelated;-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale;font-smooth:never;text-rendering:geometricPrecision;font-synthesis:none;font-kerning:none;">
            COOLDOWN: ${Math.ceil(cooldownRemaining / 1000)}s
          </span>
        `;
        weaponContainer.appendChild(cooldownDiv);
      }
      
      weapons.forEach((weapon, i) => {
        const isSelected = currentWeapon === weapon.id;
        const weaponDiv = document.createElement('div');
        weaponDiv.style.cssText = `
          margin:8px 0;
          padding:8px;
          border-radius:6px;
          cursor:${isOnCooldown ? 'not-allowed' : 'pointer'};
          border:2px solid ${isSelected ? '#f0f' : '#444'};
          background:${isSelected ? '#222' : 'transparent'};
          ${isSelected ? 'box-shadow:0 0 8px #f0f;' : ''}
          opacity:${baseOpacity};
        `;
        
        weaponDiv.innerHTML = `
          <b style="font-family:'Press Start 2P','Courier New',monospace;font-size:20px;image-rendering:pixelated;-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale;font-smooth:never;text-rendering:geometricPrecision;font-synthesis:none;font-kerning:none;">${weapon.name}</b> ${isSelected ? '<span style="color:#f0f;float:right;font-family:\'Press Start 2P\',\'Courier New\',monospace;font-size:16px;image-rendering:pixelated;-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale;font-smooth:never;text-rendering:geometricPrecision;">ACTIVE</span>' : ''}<br>
          <span style="font-size:14px;color:#ccc;font-family:'Press Start 2P','Courier New',monospace;image-rendering:pixelated;-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale;">${weapon.description}</span><br>
          <span style="font-size:12px;color:#0a0;font-family:'Press Start 2P','Courier New',monospace;image-rendering:pixelated;-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale;">Free</span>
        `;
        
        weaponDiv.onclick = () => {
          if (window.game && window.game.player) {
            // Don't allow switching to the same weapon
            if (window.game.player.weapon === weapon.id) {
              return;
            }
            
            // Check if cooldown is active at click time (fresh calculation)
            const clickTime = Date.now();
            const timeSinceLastSwitch = clickTime - lastWeaponSwitch;
            const cooldownRemaining = Math.max(0, WEAPON_COOLDOWN - timeSinceLastSwitch);
            const isClickOnCooldown = cooldownRemaining > 0;
            
            if (isClickOnCooldown) {
              // Flash red to indicate cooldown
              weaponDiv.style.background = '#400';
              setTimeout(() => {
                weaponDiv.style.background = isSelected ? '#222' : 'transparent';
              }, 200);
              return;
            }
            
            // Switch weapon and start cooldown
            window.game.player.weapon = weapon.id;
            lastWeaponSwitch = clickTime;
            renderWeaponSelector();
          }
        };
        
        weaponContainer.appendChild(weaponDiv);
      });
    }
    
    // Reset button logic
    window.addEventListener('DOMContentLoaded', () => {
      const resetBtn = document.getElementById('reset-btn');
      if (resetBtn) {
        resetBtn.onmouseenter = () => { resetBtn.style.transform = 'scale(1.07)'; };
        resetBtn.onmouseleave = () => { resetBtn.style.transform = 'scale(1)'; };
        resetBtn.onclick = () => {
          if (window.game && window.game.reset) {
            window.game.reset();
          } else {
            location.reload();
          }
        };
      }
      
      // Fullscreen button logic
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      const gameContainer = document.getElementById('game-container');
      if (fullscreenBtn && gameContainer) {
        fullscreenBtn.onclick = async () => {
          try {
            if (!document.fullscreenElement) {
              await gameContainer.requestFullscreen();
            } else {
              await document.exitFullscreen();
            }
          } catch (err) {
            console.log('Fullscreen not supported or denied:', err);
            // Fallback: try different fullscreen methods on game container
            try {
              if (gameContainer.webkitRequestFullscreen) {
                gameContainer.webkitRequestFullscreen();
              } else if (gameContainer.msRequestFullscreen) {
                gameContainer.msRequestFullscreen();
              }
            } catch (fallbackErr) {
              console.log('All fullscreen methods failed:', fallbackErr);
            }
          }
        };
      } else {
        console.log('Fullscreen button or game container not found');
      }
      
      // Skip cutscene button logic
      const skipBtn = document.getElementById('skip-cutscene-btn');
      if (skipBtn) {
        // Add hover effects
        skipBtn.onmouseenter = () => {
          skipBtn.style.background = '#444';
          skipBtn.style.transform = 'translateX(-50%) scale(1.05)';
        };
        skipBtn.onmouseleave = () => {
          skipBtn.style.background = '#222';
          skipBtn.style.transform = 'translateX(-50%) scale(1)';
        };
        
        skipBtn.onclick = () => {
          if (window.game && window.game.inCutscene && window.game.cutsceneType === 'devil') {
            // Skip to final dialogue line (PRESS Q TO SACRIFICE)
            window.game.dialogueIndex = window.game.devilDialogue.length - 1;
            skipBtn.style.display = 'none'; // Hide the skip button
            console.log('Cutscene skipped to final dialogue');
          } else {
            console.log('Cannot skip: not in devil cutscene');
          }
        };
      } else {
        console.log('Skip button not found during initialization');
      }
      
      // Debug function to test skip button
      window.testSkipButton = () => {
        const btn = document.getElementById('skip-cutscene-btn');
        if (btn) {
          btn.style.display = 'block';
          console.log('Skip button forced visible for testing');
        } else {
          console.log('Skip button element not found');
        }
      };
      
      renderWeaponSelector();
    });
    
    // Update weapon selector more frequently to show cooldown timer
    setInterval(() => {
      renderWeaponSelector();
    }, 100); // Update every 100ms for smooth cooldown countdown
  </script>
</body>
</html>
